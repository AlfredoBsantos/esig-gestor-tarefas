<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Listagem de Tarefas</title>
    <h:outputStylesheet name="css/style.css" />
</h:head>
<h:body>
    <div class="container">
        <h1>Listagem de Tarefas</h1>

        <h:form id="formListagem">
            <h:link outcome="cadastrar" value="Cadastrar Nova Tarefa" styleClass="link-cadastro"/>
            <h:messages id="messages" styleClass="messages" infoClass="info" errorClass="error" globalOnly="true"/>

            <fieldset class="filter-section">
                <legend>Filtros</legend>
                <div class="filter-group">
                    <h:outputLabel for="filtroNumero" value="Número:" />
                    <h:inputText id="filtroNumero" styleClass="input-field" style="width: 100px;" value="#{listagemTarefaBean.filtroNumero}"/>
                </div>
                <div class="filter-group" style="flex: 2;">
                    <h:outputLabel for="filtroDescricao" value="Título/Descrição:" />
                    <h:inputText id="filtroDescricao" styleClass="input-field" value="#{listagemTarefaBean.filtroTituloDescricao}"/>
                </div>
                <div class="filter-group">
                    <h:outputLabel for="filtroResponsavel" value="Responsável:" />
                    <h:selectOneMenu id="filtroResponsavel" styleClass="select-field" value="#{listagemTarefaBean.filtroResponsavel}">
                        <f:selectItem itemLabel="Todos" itemValue="#{null}" />
                        <f:selectItems value="#{listagemTarefaBean.responsaveis}"/>
                    </h:selectOneMenu>
                </div>
                <div class="filter-group">
                    <h:outputLabel for="filtroSituacao" value="Situação:" />
                    <h:selectOneMenu id="filtroSituacao" styleClass="select-field" value="#{listagemTarefaBean.filtroSituacao}">
                        <f:selectItem itemLabel="Todas" itemValue="#{null}" />
                        <f:selectItems value="#{listagemTarefaBean.situacoes}" var="s" itemLabel="#{s.descricao}" itemValue="#{s}"/>
                    </h:selectOneMenu>
                </div>
                <h:commandButton value="Buscar Tarefas" styleClass="btn" action="#{listagemTarefaBean.buscarPrimeiraPagina}">
                    <f:ajax execute="@form" render="tabelaTarefas painelVazio paginacao messages"/>
                </h:commandButton>
                <h:commandButton value="Limpar" styleClass="btn" action="#{listagemTarefaBean.limparFiltros}">
                    <f:ajax execute="@form" render="tabelaTarefas painelVazio paginacao messages"/>
                </h:commandButton>
            </fieldset>

            <h:dataTable id="tabelaTarefas" value="#{listagemTarefaBean.tarefas}" var="tarefa" styleClass="tabela-tarefas" rendered="#{not empty listagemTarefaBean.tarefas}">
                <h:column>
                    <f:facet name="header">Número</f:facet>
                    <h:outputText value="#{tarefa.numero}" />
                </h:column>
                <h:column>
                    <f:facet name="header">Título</f:facet>
                    <h:outputText value="#{tarefa.titulo}" />
                </h:column>
                <h:column>
                    <f:facet name="header">Responsável</f:facet>
                    <h:outputText value="#{tarefa.responsavel}" />
                </h:column>
                <h:column styleClass="col-acoes">
                    <f:facet name="header">Ações</f:facet>
                    <h:button value="Editar" outcome="editar" styleClass="link-como-botao">
                        <f:param name="id" value="#{tarefa.numero}" />
                    </h:button> |
                    <h:commandLink value="Excluir" action="#{listagemTarefaBean.excluir(tarefa)}" styleClass="link-como-botao">
                        <f:ajax execute="@this" render="@form"/>
                    </h:commandLink> |
                    <h:commandLink value="Concluir" action="#{listagemTarefaBean.concluir(tarefa)}" styleClass="link-como-botao" rendered="#{tarefa.situacao == 'EM_ANDAMENTO'}">
                        <f:ajax execute="@this" render="@form"/>
                    </h:commandLink>
                </h:column>
            </h:dataTable>

            <h:panelGroup id="painelVazio" rendered="#{empty listagemTarefaBean.tarefas}">
                <p>Nenhuma tarefa encontrada com os filtros aplicados.</p>
            </h:panelGroup>

            <div class="paginacao" id="paginacao">
                <h:commandButton value="&lt;&lt; Anterior" action="#{listagemTarefaBean.paginaAnterior}"
                                 disabled="#{not listagemTarefaBean.podeVoltar}" styleClass="btn">
                    <f:ajax execute="@this" render="tabelaTarefas painelVazio paginacao"/>
                </h:commandButton>

                <span>#{listagemTarefaBean.descricaoPaginacao}</span>

                <h:commandButton value="Próxima &gt;&gt;" action="#{listagemTarefaBean.proximaPagina}"
                                 disabled="#{not listagemTarefaBean.podeAvancar}" styleClass="btn">
                    <f:ajax execute="@this" render="tabelaTarefas painelVazio paginacao"/>
                </h:commandButton>
            </div>
        </h:form>
    </div>
</h:body>
</html>